<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–¢–µ—Å—Ç —á–∞—Ç–∞ SpeakUp</title>
    <style>
        body { font-family: Arial; max-width: 600px; margin: 0 auto; padding: 20px; }
        #chat { border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: scroll; margin-bottom: 10px; }
        .message { margin: 5px 0; padding: 8px; border-radius: 5px; }
        .my { background: #e3f2fd; text-align: right; }
        .other { background: #f5f5f5; }
        input, button { padding: 10px; margin: 5px; }
    </style>
</head>
<body>
    <h2>üí¨ –¢–µ—Å—Ç–æ–≤—ã–π —á–∞—Ç</h2>
    <div id="chat"></div>
    <input type="text" id="message" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." style="width:70%">
    <input type="number" id="receiver_id" placeholder="ID –ø–æ–ª—É—á–∞—Ç–µ–ª—è" value="1" style="width:20%">
    <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    
    <script>
    // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ localStorage
    const token = localStorage.getItem('speakup_token');
    if (!token) {
        alert('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É!');
        window.location.href = 'login_form.html';
    }
    
    // –î–µ–∫–æ–¥–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —Å–≤–æ–π ID
    const payload = JSON.parse(atob(token.split('.')[0] || token));
    const myId = payload.user_id;
    
    function sendMessage() {
        const message = document.getElementById('message').value;
        const receiver_id = document.getElementById('receiver_id').value;
        
        if (!message) return;
        
        fetch('messages/send.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': token
            },
            body: JSON.stringify({
                receiver_id: receiver_id,
                message: message
            })
        })
        .then(r => r.json())
        .then(data => {
            if (data.success) {
                addMessage(message, 'my');
                document.getElementById('message').value = '';
            } else {
                alert('–û—à–∏–±–∫–∞: ' + data.error);
            }
        });
    }
    
    function addMessage(text, type) {
        const chat = document.getElementById('chat');
        const msg = document.createElement('div');
        msg.className = 'message ' + type;
        msg.textContent = text;
        chat.appendChild(msg);
        chat.scrollTop = chat.scrollHeight;
    }
    
    // –¢–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    addMessage('–ü—Ä–∏–≤–µ—Ç! –ß–∞—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç!', 'my');
    addMessage('–û—Ç–≤–µ—Ç –æ—Ç –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', 'other');
    </script>
</body>
</html>